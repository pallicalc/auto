<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Opioid Conversion Calculator (Public Demo)</title>
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  
  <link rel="stylesheet" href="calculator.css">

  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore-compat.js"></script>
<script>
    // SAFETY: Prevent crash if Analytics is blocked
    window.trackEvent = window.trackEvent || function() {};
</script>
</head>
<body>

  <nav class="navbar-main">
    <a href="../index.html" class="navbar-link"><i class="bi bi-house-door"></i> Home</a>
    <a href="../guides/opioid-conversion.html" class="navbar-link">📖 Conversion Guide</a>
    <a href="../guides/prn-calculation.html" class="navbar-link">💉 PRN Guide</a>
  </nav>

  <div class="demo-banner">
    <strong><i class="bi bi-cone-striped"></i> Public Demo Mode</strong>
    You are using the default opioid conversion ratios. 
    <br>
    <em>Note: Only registered members can save custom institutional or personal ratios.</em>
  </div>

  <div id="nav">
    <span id="toCalcLink" style="display:none;">
      <a onclick="navigateToCalc()">← Back to Calculator</a>
    </span>
    <span id="toEditLink">
      <a onclick="navigateToEdit()">View/Test Conversion Ratios</a>
    </span>
  </div>

  <div id="calcPage">
    <h2>Opioid Conversion Calculator (Total Daily Dose)</h2>

    <fieldset>
      <legend>Current Primary REGULAR Opioid Therapy</legend>
      <select id="inputRoute1" aria-label="Primary opioid route"></select>
      <select id="inputName1" aria-label="Primary opioid name"></select>
      <label for="inputDose1">Enter Dose (total taken in 24 hours)</label>
      <input type="number" id="inputDose1" class="dose-input" />
      <span id="inputUnit1" class="unit-span"></span>
      <div id="warningMsg1" class="inline-warning">⚠️ High Dose Alert: Please confirm dose and units.</div>
    </fieldset>

    <button id="showPrnBtn" class="btn btn-success" onclick="togglePrn()">Add Additional/PRN Opioid 1</button>

    <fieldset id="prnOpioid1">
      <legend>Current Additional/PRN Opioid Therapy 1</legend>
      <label for="inputRoute2">
        <select id="inputRoute2" aria-label="Additional opioid route 1"></select>
      </label>
      <label for="inputName2">
        <select id="inputName2" aria-label="Additional opioid name 1"></select>
      </label>
      <label for="inputDose2">Enter Dose (total taken in 24 hours):</label>
      <input type="number" id="inputDose2" min="0" step="0.1" class="dose-input" />
      <span id="inputUnit2" class="unit-span"></span>
      <div class="note">*Do not include PRN dose due to incidental pain.*</div>
      <div id="warningMsg2" class="inline-warning">⚠️ High Dose Alert: Please confirm dose and units.</div>
    </fieldset>

    <fieldset id="prnOpioid2">
      <legend>Current Additional/PRN Opioid Therapy 2</legend>
      <label for="inputRoute3">
        <select id="inputRoute3" aria-label="Additional opioid route 2"></select>
      </label>
      <label for="inputName3">
        <select id="inputName3" aria-label="Additional opioid name 2"></select>
      </label>
      <label for="inputDose3">Enter Dose (total taken in 24 hours):</label>
      <input type="number" id="inputDose3" min="0" step="0.1" class="dose-input" />
      <span id="inputUnit3" class="unit-span"></span>
      <div class="note">*Do not include PRN dose due to incidental pain.*</div>
      <div id="warningMsg3" class="inline-warning">⚠️ High Dose Alert: Please confirm dose and units.</div>
    </fieldset>

    <fieldset id="prnOpioid3">
      <legend>Current Additional/PRN Opioid Therapy 3</legend>
      <label for="inputRoute4">
        <select id="inputRoute4" aria-label="Additional opioid route 3"></select>
      </label>
      <label for="inputName4">
        <select id="inputName4" aria-label="Additional opioid name 3"></select>
      </label>
      <label for="inputDose4">Enter Dose (total taken in 24 hours):</label>
      <input type="number" id="inputDose4" min="0" step="0.1" class="dose-input" />
      <span id="inputUnit4" class="unit-span"></span>
      <div class="note">*Do not include PRN dose due to incidental pain.*</div>
      <div id="warningMsg4" class="inline-warning">⚠️ High Dose Alert: Please confirm dose and units.</div>
    </fieldset>

    <fieldset id="convertFinalBox" class="fieldset-convert" style="margin-top:20px;">
      <legend class="legend-blue">Convert to opioid</legend>
      <label for="outputRoute"></label>
      <select id="outputRoute" aria-label="Output opioid route"></select>
      <label for="outputName"></label>
      <select id="outputName" aria-label="Output opioid name"></select>
    </fieldset>

    <button id="convertBtn" class="btn btn-primary" onclick="convert()">Convert</button>

    <div id="resultBox" class="result-box" style="display:none;"></div>

    <fieldset id="prnCalculation" class="fieldset-prn" style="margin-top:20px;">
      <legend class="legend-aqua">Calculate PRN Dose</legend>
      <label for="prnRouteSelect"></label>
      <select id="prnRouteSelect" aria-label="PRN opioid route"></select>
      <select id="prnNameSelect" aria-label="PRN opioid name"></select>
      <div id="prnDoseOutput" class="prn-output-box" style="display:none;"></div>
    </fieldset>

    <button id="clearBtn" class="btn btn-danger" style="margin-top:8px; padding:8px;" onclick="clearCalculator()">
      Clear Calculator
    </button>
  </div>

  <div id="editPage" style="display:none;">
    <h2>Default Opioid → PO Morphine Ratios</h2>
    
    <div class="alert-box">
      <i class="bi bi-info-circle-fill"></i> <strong>Demo Mode:</strong> <br>
      You can modify values below to test different conversion scenarios, but changes <u>will not be saved</u> permanently.
    </div>
    
    <button id="resetBtn" class="btn btn-danger" type="button" onclick="resetToDefaults()" style="margin-bottom: 10px;">
      Reset to Defaults
    </button>

    <table>
      <thead>
        <tr>
          <th class="select-col">Include</th>
          <th class="route-col">Route</th>
          <th class="opioid-name-col">Opioid Name</th>
          <th class="ratio-col">Ratio (to PO Morphine)</th>
          <th class="unit-col">Unit</th>
        </tr>
      </thead>
      <tbody id="ratioTableBody"></tbody>
    </table>
    
    <div style="text-align: center; margin-top: 20px; color: #666;">
        <em>Register for free to save custom ratios permanently.</em>
    </div>
  </div>

  <footer style="max-width: 480px; margin: 30px auto 0; padding: 20px; background-color: #f8f9fa; border-top: 1px solid #dee2e6; text-align: center; font-family: sans-serif; font-size: 11px; color: #6c757d; border-radius: 8px 8px 0 0;">
      <p style="margin: 0 0 5px; font-weight: bold;">&copy; 2026 Alivioscript Solutions</p>
      <p style="margin: 0 0 5px;">Author: Alison Chai, RPh (M'sia): 9093, GPhC (UK): 2077838</p>
      <p style="margin: 0; color: #dc3545; font-weight: 600;">For Educational Use Only. Not a Medical Device.<br>Verify all results.</p>
  </footer>

  <script src="js/demo-opioid.js"></script>
<script src="/js/ga-tracking.js"></script>
</body>
</html>