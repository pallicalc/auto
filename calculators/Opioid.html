<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Opioid Conversion Calculator (Total Daily Dose)</title>
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  <link rel="stylesheet" href="calculator.css">

  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore-compat.js"></script>
</head>
<body>

  <nav class="navbar-main">
    <a href="../all-calculators.html" class="navbar-link">
        <i class="bi bi-house-door"></i> Back to All Calculators
    </a>
    <a href="../guides/opioid-conversion.html" class="navbar-link">📖 Conversion Guide</a>
    <a href="../guides/prn-calculation.html" class="navbar-link">💉 PRN Guide</a>
  </nav>

  <div id="nav">
    <span id="toCalcLink" style="display:none;">
      <a onclick="navigateToCalc()">← Back to Calculator</a>
    </span>
    <span id="toEditLink">
      <a onclick="navigateToEdit()">Edit Conversion Ratios</a>
    </span>
  </div>

  <div id="ratioBanner" class="ratio-banner">
    Loading ratio status...
  </div>

  <div id="calcPage" style="display:none;">
    <h2>Opioid Conversion Calculator (Total Daily Dose)</h2>

    <fieldset>
      <legend>Current Primary REGULAR Opioid Therapy</legend>
      <select id="inputRoute1" aria-label="Primary opioid route"></select>
      <select id="inputName1" aria-label="Primary opioid name"></select>
      <label for="inputDose1">Enter Dose (total taken in 24 hours)</label>
      <input type="number" id="inputDose1" class="dose-input" />
      <span id="inputUnit1" class="unit-span"></span>
      <div id="warningMsg1" class="inline-warning">⚠️ High Dose Alert: Please confirm dose and units.</div>
    </fieldset>

    <button id="showPrnBtn" class="btn btn-success" onclick="togglePrn()">Add Additional/PRN Opioid 1</button>

    <fieldset id="prnOpioid1" style="display:none;">
      <legend>Current Additional/PRN Opioid Therapy 1</legend>
      <label for="inputRoute2">
        <select id="inputRoute2" aria-label="Additional opioid route 1"></select>
      </label>
      <label for="inputName2">
        <select id="inputName2" aria-label="Additional opioid name 1"></select>
      </label>
      <label for="inputDose2">Enter Dose (total taken in 24 hours):</label>
      <input type="number" id="inputDose2" min="0" step="0.1" class="dose-input" />
      <span id="inputUnit2" class="unit-span"></span>
      <div class="note">*Do not include PRN dose due to incidental pain.*</div>
      <div id="warningMsg2" class="inline-warning">⚠️ High Dose Alert: Please confirm dose and units.</div>
    </fieldset>

    <fieldset id="prnOpioid2" style="display:none;">
      <legend>Current Additional/PRN Opioid Therapy 2</legend>
      <label for="inputRoute3">
        <select id="inputRoute3" aria-label="Additional opioid route 2"></select>
      </label>
      <label for="inputName3">
        <select id="inputName3" aria-label="Additional opioid name 2"></select>
      </label>
      <label for="inputDose3">Enter Dose (total taken in 24 hours):</label>
      <input type="number" id="inputDose3" min="0" step="0.1" class="dose-input" />
      <span id="inputUnit3" class="unit-span"></span>
      <div class="note">*Do not include PRN dose due to incidental pain.*</div>
      <div id="warningMsg3" class="inline-warning">⚠️ High Dose Alert: Please confirm dose and units.</div>
    </fieldset>

    <fieldset id="prnOpioid3" style="display:none;">
      <legend>Current Additional/PRN Opioid Therapy 3</legend>
      <label for="inputRoute4">
        <select id="inputRoute4" aria-label="Additional opioid route 3"></select>
      </label>
      <label for="inputName4">
        <select id="inputName4" aria-label="Additional opioid name 3"></select>
      </label>
      <label for="inputDose4">Enter Dose (total taken in 24 hours):</label>
      <input type="number" id="inputDose4" min="0" step="0.1" class="dose-input" />
      <span id="inputUnit4" class="unit-span"></span>
      <div class="note">*Do not include PRN dose due to incidental pain.*</div>
      <div id="warningMsg4" class="inline-warning">⚠️ High Dose Alert: Please confirm dose and units.</div>
    </fieldset>

    <fieldset id="convertFinalBox" class="fieldset-convert" style="margin-top:20px;">
      <legend class="legend-blue">Convert to opioid</legend>
      <label for="outputRoute"></label>
      <select id="outputRoute" aria-label="Output opioid route"></select>
      <label for="outputName"></label>
      <select id="outputName" aria-label="Output opioid name"></select>
    </fieldset>

    <button id="convertBtn" class="btn btn-primary" onclick="convert()">Convert</button>

    <div id="resultBox" class="result-box" style="display:none;"></div>

    <fieldset id="prnCalculation" class="fieldset-prn" style="margin-top:20px;">
      <legend class="legend-aqua">Calculate PRN Dose</legend>
      <label for="prnRouteSelect"></label>
      <select id="prnRouteSelect" aria-label="PRN opioid route"></select>
      <select id="prnNameSelect" aria-label="PRN opioid name"></select>
      <div id="prnDoseOutput" class="prn-output-box" style="display:none;"></div>
    </fieldset>

    <button id="clearBtn" class="btn btn-danger" style="margin-top:8px; padding:8px;" onclick="clearCalculator()">
      Clear Calculator
    </button>
  </div>

  <div id="editPage" style="display:none;">
    <h2>Edit Opioid → PO Morphine Ratios</h2>
    <form onsubmit="return saveRatios();">
      <button id="resetBtn" class="btn btn-danger" type="button" onclick="resetToDefaults()">
        Reset to Default Ratios
      </button>
      <table>
        <thead>
          <tr>
            <th class="select-col">Include</th>
            <th class="route-col">Route</th>
            <th class="opioid-name-col">Opioid Name</th>
            <th>Ratio (to PO Morphine)</th>
            <th>Unit</th>
          </tr>
        </thead>
        <tbody id="ratioTableBody"></tbody>
      </table>
      <label for="passInput">Enter login password to save:</label>
      <input type="password" id="passInput" autocomplete="off" />
      <button id="saveBtn" class="btn btn-primary" type="submit">Save</button>
      <span id="msgArea" class="success" style="display:none;"></span>
      <span id="errorArea" class="fail" style="display:none;"></span>
    </form>
  </div>

  <footer style="max-width: 480px; margin: 30px auto 0; padding: 20px; background-color: #f8f9fa; border-top: 1px solid #dee2e6; text-align: center; font-family: sans-serif; font-size: 11px; color: #6c757d; border-radius: 8px 8px 0 0;">
    <p style="margin: 0 0 5px; font-weight: bold;">&copy; 2026 Alivioscript Solutions</p>
    <p style="margin: 0 0 5px;">Author: Alison Chai, RPh (M'sia): 9093, GPhC (UK): 2077838</p>
    <p style="margin: 0; color: #dc3545; font-weight: 600;">For Educational Use Only. Not a Medical Device. Verify all results.</p>
  </footer>

  <script src="js/opioid.js"></script>

  <script>
    window.addEventListener('load', function() {
      // We check if a known function from the external file exists
      if (typeof init !== 'function') {
        alert("CRITICAL ERROR: 'js/opioid.js' failed to load.\n\n1. Ensure you created the 'js' folder.\n2. Ensure 'opioid.js' is inside that folder.");
        document.body.innerHTML = "<h2 style='color:red; text-align:center; margin-top:50px;'>Error: js/opioid.js file not found.</h2>";
      }
    });
  </script>
<script src="/js/ga-tracking.js"></script>
</body>
</html>